= IDP

本文记录 IDP 的实现过程。

== 确定模块名称

sample-sso-oidc-idp。

== 创建模块

https://github.com/peacetrue/sample-sso-oidc/tree/master/sample-sso-oidc-idp[sample-sso-oidc-idp^] 。

== 配置模块依赖

.build.gradle
[{source},groovy]
----
include::{path}/build.gradle[tags=spring]
include::{path-idp}/build.gradle[tags=authorization-server]
----

== 创建启动类

.IdpOidcApplication
[{source},java]
----
include::{path-idp-main-package}/IdpOidcApplication.java[tags=class]
----

== 创建配置文件

.application.yml
[{source},yml]
----
include::{path-idp-main}/resources/application.yml[]
----

== 配置模块功能

=== 创建配置类

.IdpOidcConfiguration
[{source},java]
----
include::{path-idp-main-package}/IdpOidcConfiguration.java[tags=class-start;class-end]
----

=== [.line-through]#引入配置#

.IdpOidcConfiguration
[{source},java]
----
include::{path-idp-main-package}/IdpOidcConfiguration.java[tags=import;class-start;class-end]
----
<.> 下面会重新声明相关配置

=== 配置安全过滤器链

.IdpOidcConfiguration
[{source},java]
----
include::{path-idp-main-package}/IdpOidcConfiguration.java[tags=SecurityFilterChain;class-start;class-end]
----

=== 配置客户端

服务端只会受理自己认识的客户端，所以需要事先在 IDP 中声明 SP。

.IdpOidcConfiguration
[{source},java]
----
include::{path-idp-main-package}/IdpOidcConfiguration.java[tags=class-start;registeredClient;class-end]
----

=== 配置 JWT

.IdpOidcConfiguration
[{source},java]
----
include::{path-idp-main-package}/IdpOidcConfiguration.java[tags=jwt;class-start;class-end]
----

=== 配置端点信息

.IdpOidcConfiguration
[{source},java]
----
include::{path-idp-main-package}/IdpOidcConfiguration.java[tags=providerSettings;class-start;class-end]
----

上面只配置了 issuer 地址，其他端点地址会使用默认值：

//http://127.0.0.1:9300/oidc-idp/.well-known/openid-configuration
..well-known/openid-configuration
[{source},json]
----
include::example$openid-configuration.json[]
----





